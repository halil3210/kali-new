# KLCP Quiz App - Komplette Bedienungsanleitung
**Version:** 1.0.0 - Dezember 2025
**Projekt-Pfad:** /home/halil/newmultichoice

---

## üìã √úBERSICHT

Das KLCP Quiz ist eine moderne Android-Quiz-App f√ºr die KLCP-Zertifizierung mit:
- ‚úÖ 375 offizielle KLCP-Zertifizierungsfragen
- ‚úÖ Zweisprachig (Englisch/Deutsch)
- ‚úÖ Material Design 3 UI mit Dynamic Colors
- ‚úÖ Offline-First Architektur
- ‚úÖ Server-Sync f√ºr Multi-Ger√§t-Support
- ‚úÖ Achievement-System
- ‚úÖ Haptic Feedback & moderne Animationen

---

## üèóÔ∏è PROJEKT-STRUKTUR

### Android App (`app/`)
```
app/src/main/java/alie/info/newmultichoice/
‚îú‚îÄ‚îÄ api/           # Server-Kommunikation (Retrofit)
‚îú‚îÄ‚îÄ auth/          # Authentifizierung & Profile
‚îú‚îÄ‚îÄ data/          # Datenmodelle & Room Database
‚îú‚îÄ‚îÄ ui/            # UI-Fragments (Home, Quiz, Result, etc.)
‚îú‚îÄ‚îÄ utils/         # Hilfsklassen (Haptic, Logging, etc.)
‚îî‚îÄ‚îÄ services/      # Background-Services (Sync, Achievements)
```

### Server (`test_server/`)
```
‚îú‚îÄ‚îÄ server.js      # Express-Server Entry Point
‚îú‚îÄ‚îÄ authRoutes.js  # Registration/Login/Verification
‚îú‚îÄ‚îÄ syncRoutes.js  # Daten-Synchronisation
‚îú‚îÄ‚îÄ statsRoutes.js # Statistiken & Sessions
‚îú‚îÄ‚îÄ database.js    # SQLite-Wrapper
‚îî‚îÄ‚îÄ klcp_quiz.db   # SQLite-Datenbank
```

### Datenverarbeitung (Python Scripts)
- `create_perfect_json.py` - Erstellt Fragen-JSON aus PDFs
- `fix_all_375_questions.py` - Korrigiert Antworten
- `verify_answers.py` - Validierung der Antworten
- `rebuild_questions.py` - Rekonstruiert Fragen-Datenbank

---

## üöÄ SCHNELLSTART

### 1. Android App bauen & installieren
```bash
# Debug-Version bauen (empfohlen f√ºr Entwicklung)
./gradlew assembleDebug

# Release-Version bauen (ben√∂tigt local.properties mit Signierung)
./gradlew assembleRelease

# APK installieren
adb install app/build/outputs/apk/debug/app-debug.apk
```

### 2. Server starten (f√ºr Sync-Features)
```bash
cd test_server
npm install
node server.js
# Server l√§uft auf http://localhost:3000
```

### 3. Fragen-Daten aktualisieren
```bash
# Neue Fragen aus PDFs extrahieren
python3 create_perfect_json.py

# Antworten korrigieren
python3 fix_all_375_questions.py

# Validierung durchf√ºhren
python3 verify_answers.py
```

---

## üì± ANDROID APP FEATURES

### Material Design 3 Features
- **Dynamic Colors** - Passt sich an Systemfarben an
- **Dark Mode** - Automatisch oder manuell
- **Edge-to-Edge Display** - Volle Bildschirmnutzung
- **Haptic Feedback** - Unterschiedliche Vibrationen f√ºr Aktionen

### Quiz-Funktionalit√§t
- **375 KLCP-Fragen** - Offizieller Fragenkatalog
- **Sprachumschaltung** - Englisch ‚Üî Deutsch
- **Sofortiges Feedback** - Visuelle & haptische R√ºckmeldung
- **Progress Tracking** - Automatische Speicherung
- **Ergebnis-Analyse** - Detaillierte Statistiken

### Achievement-System
- **10 Badge-Kategorien**: Beginner, Learner, Master, etc.
- **Streak-Tracking** - T√§gliche Quiz-Serien
- **Performance-Metriken** - Richtige Antworten, Zeit, etc.

---

## üîß ENTWICKLUNGS-SETUP

### Voraussetzungen
- **Android Studio** Ladybug | 2024.2.1+
- **JDK 11+**
- **Android SDK 26+** (Android 8.0+)
- **Gradle 8.12.3**

### Build-Konfiguration
```gradle
// app/build.gradle.kts - Wichtige Dependencies
dependencies {
    // Material Design 3
    implementation("com.google.android.material:material:1.12.0")

    // Room Database
    implementation("androidx.room:room-runtime:2.6.1")
    implementation("androidx.room:room-ktx:2.6.1")

    // Networking (Retrofit)
    implementation("com.squareup.retrofit2:retrofit:2.9.0")
    implementation("com.squareup.retrofit2:converter-gson:2.9.0")

    // Coroutines & Flow
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.8.1")
}
```

---

## üåê SERVER SETUP & DEPLOYMENT

### Lokaler Test-Server
```bash
cd test_server

# Dependencies installieren
npm install

# Server starten
node server.js

# Testen
curl http://localhost:3000/api/health
```

### Produktions-Server (Hetzner)
```bash
# Server von Hetzner herunterladen
./download_from_hetzner.sh

# Server deployen
./deploy-server.sh

# Neuer Server einrichten
./setup_new_server.sh
```

### Server-API Endpunkte
```
GET  /api/health              # Server-Status
POST /api/auth/register       # User-Registrierung
POST /api/auth/login          # User-Login
POST /api/sync/upload         # Daten hochladen
GET  /api/sync/download/:id   # Daten herunterladen
GET  /api/stats/user/:id      # User-Statistiken
POST /api/stats/update        # Statistiken aktualisieren
```

### Datenbank-Verwaltung
```bash
# Datenbank inspizieren
sqlite3 klcp_quiz.db '.tables'
sqlite3 klcp_quiz.db '.schema users'
sqlite3 klcp_quiz.db 'SELECT * FROM users;'

# User hinzuf√ºgen
sqlite3 klcp_quiz.db "INSERT INTO users (email, password_hash) VALUES ('test@example.com', '$2b$12$...');"
```

---

## üìä DATENVERARBEITUNG (PYTHON SCRIPTS)

### Fragen-Extraktion aus PDFs
```bash
# Vollst√§ndige Fragen aus KLCP_Fragenkatalog.pdf extrahieren
python3 create_perfect_json.py
# ‚Üí Erstellt app/src/main/assets/questions.json
```

### Antworten-Korrektur
```bash
# Alle 375 Antworten manuell korrigieren
python3 fix_all_375_questions.py

# Antworten aus KLCP_Loesungen.pdf extrahieren
python3 extract_pdf_answers.py

# Vollst√§ndige Korrektur durchf√ºhren
python3 complete_corrections.py
```

### Validierung & Tests
```bash
# Antworten validieren
python3 verify_answers.py

# Alle Fragen neu aufbauen
python3 rebuild_questions.py

# Vollst√§ndige JSON-Datei erstellen
python3 create_perfect_json.py
```

### Daten-Analyse
```bash
# PDF-Inhalt analysieren
python3 pdf_analysis.txt  # (enth√§lt Analysen)

# Erste Seiten extrahieren
head -n 50 first_pages.txt
```

---

## üîê SICHERHEIT & KONFIGURATION

### Kritische Sicherheitsprobleme (beheben!)
```bash
# SOFORT BEHEBEN (aus SECURITY_AUDIT_REPORT.md)

# Port 3000 blockieren (nur √ºber Nginx erreichbar)
ufw deny 3000/tcp

# SSH Root-Login deaktivieren
sed -i 's/PermitRootLogin yes/PermitRootLogin prohibit-password/' /etc/ssh/sshd_config
systemctl restart sshd

# .env-Datei sichern
chmod 600 /opt/klcp-server/.env
chown root:root /opt/klcp-server/.env

# Datenbank sichern
chmod 600 /opt/klcp-server/klcp_quiz.db
chown root:root /opt/klcp-server/klcp_quiz.db

# System-Updates
apt update && apt upgrade -y
```

### JWT & Authentifizierung
```javascript
// server.js - WICHTIG: Keine Fallback-Secrets!
const JWT_SECRET = process.env.JWT_SECRET;
if (!JWT_SECRET) {
  throw new Error('JWT_SECRET environment variable is required');
}

// Access Token: 15 Minuten
// Refresh Token: 7 Tage (implementieren!)
```

### CORS-Konfiguration
```javascript
// server.js - Nur erlaubte Domains!
app.use(cors({
  origin: ['https://klcp.alie.info', 'https://www.klcp.alie.info'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE'],
  allowedHeaders: ['Content-Type', 'Authorization']
}));
```

---

## üîÑ SYNC & BACKUP SYSTEM

### Offline-First Strategie
- **App funktioniert 100% offline**
- **Fragen sind lokal gespeichert**
- **Quiz-Logik l√§uft lokal**
- **Server ist nur f√ºr Backup/Sync**

### Automatischer Sync
```kotlin
// Alle 6 Stunden (wenn WiFi verf√ºgbar)
val constraints = Constraints.Builder()
    .setRequiredNetworkType(NetworkType.UNMETERED)
    .setRequiresBatteryNotLow(true)
    .build()

WorkManager.getInstance(context)
    .enqueueUniquePeriodicWork(
        "sync_work",
        ExistingPeriodicWorkPolicy.KEEP,
        PeriodicWorkRequestBuilder<SyncWorker>(6, TimeUnit.HOURS)
            .setConstraints(constraints)
            .build()
    )
```

### Manueller Sync
```kotlin
lifecycleScope.launch {
    val syncManager = SyncManager(requireContext())
    when (val result = syncManager.smartSync()) {
        is SyncResult.Success -> {
            Toast.makeText(context, result.message, Toast.LENGTH_SHORT).show()
        }
        is SyncResult.Failure -> {
            Log.e("Sync", result.error)
        }
    }
}
```

---

## üß™ TESTING & DEBUGGING

### Android Tests
```bash
# Unit Tests
./gradlew testDebugUnitTest

# Instrumented Tests
./gradlew connectedAndroidTest

# Spezifische Tests
./gradlew testDebugUnitTest --tests="*QuizViewModelTest*"
```

### Server Tests
```bash
# Health Check
curl http://localhost:3000/api/health

# Auth Test
curl -X POST http://localhost:3000/api/auth/register \
  -H 'Content-Type: application/json' \
  -d '{"email":"test@example.com","password":"test12345"}'

# Sync Test
curl -X POST http://localhost:3000/api/sync/upload \
  -H 'Content-Type: application/json' \
  -d '{"userId":"123","quizSessions":[...]}'
```

### Datenbank-Debugging
```bash
# Server-Logs pr√ºfen
pm2 logs klcp-server --lines 50

# Datenbank-Inhalte
sqlite3 klcp_quiz.db 'SELECT COUNT(*) FROM users;'
sqlite3 klcp_quiz.db 'SELECT * FROM quiz_sessions LIMIT 5;'

# PM2 Status
pm2 list
pm2 restart klcp-server
```

---

## üöÄ DEPLOYMENT & CI/CD

### Release Build Setup
```properties
# local.properties (nicht im Git!)
storeFile=../klcp-release-key.jks
storePassword=your_secure_password
keyAlias=klcp-key
keyPassword=your_secure_password
```

### GitHub Actions Beispiel
```yaml
name: Build and Release
on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'

      - name: Build Release APK
        run: ./gradlew assembleRelease
        env:
          SIGNING_KEY_STORE_PASSWORD: ${{ secrets.SIGNING_KEY_STORE_PASSWORD }}
          SIGNING_KEY_PASSWORD: ${{ secrets.SIGNING_KEY_PASSWORD }}
          SIGNING_KEY_ALIAS: ${{ secrets.SIGNING_KEY_ALIAS }}
```

---

## üêõ PROBLEM-L√ñSUNGEN

### H√§ufige Probleme

#### 1. Gradle Build fehlgeschl√§gt
```bash
# Cache leeren
./gradlew clean
rm -rf ~/.gradle/caches/

# Neu bauen
./gradlew assembleDebug
```

#### 2. Server startet nicht (Port belegt)
```bash
# Port freigeben
fuser -k 3000/tcp 2>/dev/null || true

# Server neustarten
pm2 restart klcp-server
```

#### 3. Datenbank-Schema Fehler
```bash
# Schema pr√ºfen
sqlite3 klcp_quiz.db '.schema users'

# Spalte hinzuf√ºgen falls fehlt
sqlite3 klcp_quiz.db 'ALTER TABLE users ADD COLUMN verification_code TEXT;'
```

#### 4. Sync funktioniert nicht
```bash
# Netzwerk-Konnektivit√§t pr√ºfen
ping 192.168.44.1  # WiFi AP
ping 192.168.178.27 # Heimnetzwerk

# Server-Logs pr√ºfen
pm2 logs klcp-server --lines 20
```

---

## üìà MONITORING & ANALYTICS

### Server-Monitoring
```bash
# PM2 Monitoring
pm2 monit

# System-Ressourcen
htop
df -h
free -h

# Nginx Logs
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### App Analytics (implementiert)
- **Quiz-Sessions** - Vollst√§ndige Session-Historie
- **User-Performance** - Statistiken pro User
- **Achievement-Progress** - Badge-Fortschritt
- **Sync-Status** - Letzte Synchronisation

---

## üîÑ WORKFLOWS

### T√§gliche Entwicklung
1. **Code-√Ñnderungen** in Android Studio
2. **Build testen**: `./gradlew assembleDebug`
3. **App installieren**: `adb install ...`
4. **Funktionen testen** auf Device/Emulator
5. **Server-Integration testen** (falls n√∂tig)

### Neue Fragen hinzuf√ºgen
1. **PDF-Dateien aktualisieren** (`KLCP_Fragenkatalog.pdf`, `KLCP_Loesungen.pdf`)
2. **Python-Scripts ausf√ºhren**: `create_perfect_json.py`
3. **Antworten korrigieren**: `fix_all_375_questions.py`
4. **Validierung**: `verify_answers.py`
5. **App neu bauen** und testen

### Server-Deployment
1. **Lokale Tests** in `test_server/`
2. **Code auf Server kopieren**: `./copy_server_from_hetzner.sh`
3. **Server neustarten**: `pm2 restart klcp-server`
4. **Sicherheit pr√ºfen**: Alle Fixes aus `SECURITY_AUDIT_REPORT.md`
5. **Monitoring einrichten**

---

## üìû SUPPORT & KONTAKTE

### Dokumentation
- `README.md` - Haupt-Features & Setup
- `SERVER_INTEGRATION_GUIDE.md` - Server-Integration
- `SECURITY_AUDIT_REPORT.md` - Sicherheits-Status
- `AI_INSTRUCTIONS.md` - Server-Entwicklungshinweise

### Wichtige Dateien
- `app/src/main/assets/questions.json` - Quiz-Fragen
- `test_server/klcp_quiz.db` - Server-Datenbank
- `local.properties` - Build-Konfiguration (nicht im Git!)
- `.env` - Server-Umgebungsvariablen

### Backup-Strategie
```bash
# Wichtige Dateien sichern
tar -czf backup_$(date +%Y%m%d).tar.gz \
  test_server/klcp_quiz.db \
  app/src/main/assets/questions.json \
  local.properties \
  klcp-release-key.jks
```

---

## üéØ ZUK√úNFTIGE FEATURES (Roadmap)

### Phase 2 (2026)
- [ ] Bottom Sheet Settings Panel
- [ ] Swipe Gestures f√ºr Navigation
- [ ] Jetpack Compose f√ºr neue Screens
- [ ] Quiz-Statistiken mit Charts
- [ ] Onboarding-Flow f√ºr neue User

### Phase 3 (2026+)
- [ ] Timed Quiz Mode
- [ ] Custom Quiz (Fragenanzahl w√§hlbar)
- [ ] Bookmark-System f√ºr schwierige Fragen
- [ ] Learning Mode mit Erkl√§rungen
- [ ] Cloud Sync der Fortschritte

---

## ‚ö†Ô∏è WICHTIGE HINWEISE

1. **Fragen werden NICHT vom Server geladen!** App ist offline-first
2. **Server ist nur Backup/Cloud-Storage** f√ºr User-Fortschritt
3. **Sicherheitsaudits** regelm√§√üig durchf√ºhren (alle 3 Monate)
4. **Datenbank-Schema** vor Code-Deployments pr√ºfen
5. **JWT-Secrets** niemals im Code hardcoden
6. **Port 3000** nicht direkt exponieren (nur √ºber Nginx)
7. **Root-Login** √ºber SSH deaktivieren
8. **System-Updates** regelm√§√üig installieren

---

**Letzte Aktualisierung:** Dezember 2025
**Erstellt von:** Halil Y√ºcedag
**Projekt-Version:** 1.0.0
